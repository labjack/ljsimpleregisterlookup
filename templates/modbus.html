<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="static/js/jquery_1.10.2.min.js"></script>
    <script src="static/js/jquery_2.1.1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">

   
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>




    <style type="text/css">
      @import url('https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.5/css/bootstrap.css');
      @import url('//cdn.datatables.net/1.10.18/css/dataTables.bootstrap4.min.css');
      td.details-control{
        background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/f/f1/MediaWiki_Vector_skin_action_arrow.svg/2000px-MediaWiki_Vector_skin_action_arrow.svg.png')center center;
        background-repeat: no-repeat;
        background-size: 35px 35px;
        cursor: pointer;
      }
      td.details-control:hover { 
        background-color: #96c8ff;
      }
      tr.shown td.details-control{
        background: url('http://ljsimpleregisterlookup.herokuapp.com/static/images/details_close.png')center center;
        background-repeat: no-repeat;
        background-size: 35px 35px;
      }
      .hover-color:hover {
        background-color: #7DAEC6;
      }
      .desline{
         white-space: nowrap;
         display: -webkit-box;
        -webkit-line-clamp: 1;
      }
      .shortdes{
        max-width: 80%;
        /*width: 100px;*/
        white-space: nowrap;
        -o-text-overflow: ellipsis;

        /*line-height: 1.7;*/
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;  
        text-overflow: ellipsis;
      }
      .tabledetails{
        display: none;
      }
      .tableRow{
        background-color: #b8daff;
        height: 3em;
      }
      .registerName{
        word-wrap: break-word;
      }
      .expand-details{
        background-color: #d6d8db;
        max-width:60em;
        word-wrap:break-word;
      }
      .combo-label {
        margin-bottom:.5em;
      }
      i.details-expand{
        cursor:pointer;
        color:blue;
        text-decoration:none;
      }
      i.details-expand:hover {
        text-decoration:underline;
      }
      .dropdown-toggle::after{
        display: none;
      }
      #modbus div.filter-option{
        padding-left: 10px !important;
      }
      .text-sizing{
        font-size: 0.8rem;
      }
        tr.border_bottom td {
    border-bottom:1pt solid black;
     }
     .toolbar {
    float: left;
    }
    </style>
  </head>
  <body class="text-sizing" style=" background-color: #AED3E5;">
    <div style="width: 850px;">
    
    <div  style="padding: 10px;">
      <table id="modbus" class="display" style="width:100%;table-layout: fixed;">
        <thead>
          <tr class="table-info">
            <th scope="col" style="width: 3%;"></th>
            <th scope="col" style="width: 20%;" class="hover-color">Name</th>
            <th scope="col" style="width: 24%;" class="hover-color">Description</th>
            <th scope="col" style="width: 6%;" class="hover-color">Start Address</th>
            <th scope="col" style="width: 6%;">
              <select id="Type" data-width="30%"  class="selectpicker">
                <option value="">Type</option>
                <option value="FLOAT32">FLOAT32</option>
                <option value="UINT16">UINT16</option>
                <option value="UINT32">UINT32</option>
                <option value="FLOAT32">FLOAT32</option>
                <option value="BYTE">BYTE</option>
                <option value="STRING">STRING</option>
              </select>
            </th>
            <th scope="col" style="width: 6%;">
              <select id="Access" data-width="45%" class="selectpicker">
                <option value="">R/W</option>
                <option value="W">W</option>
                <option value="R">R</option>
              </select>
            </th>
            <th scope="col" style="width: 6%;">
              <select id="Tags" class="selectpicker" multiple title="Tags" data-width="40%"  data-live-search="true" multiple data-selected-text-format="static" data-size="5">
                <option value="AIN">AIN</option>
                <option value="AIN_EF">AIN_EF</option>
                <option value="ASYNCH">ASYNCH</option>
                <option value="CONFIG">CONFIG</option>
                <option value="CORE">CORE</option>
                <option value="DAC">DAC</option>
                <option value="DIO">DIO</option>
                <option value="DIO_EF">DIO_EF</option>
                <option value="ETHERNET">ETHERNET</option>
                <option value="FILE_IO">FILE_IO</option>
                <option value="I2C">I2C</option>
                <option value="INTFLASH">INTFLASH</option>
                <option value="LUA">LUA</option>
                <option value="ONEWIRE">ONEWIRE</option>
                <option value="RTC">RTC</option>
                <option value="SBUS">SBUS</option>
                <option value="SPI">SPI</option>
                <option value="STREAM">STREAM</option>
                <option value="TDAC">TDAC</option>
                <option value="UART">UART</option>
                <option value="USER_RAM">USER_RAM</option>
                <option value="WATCHDOG">WATCHDOG</option>
                <option value="WIFI">WIFI</option>
              </select>
            </th>
            <th scope="col" >Devices</th>
            <th scope="col" >Other Names</th>
            <th scope="col" >Other Address</th>
          </tr>
        </thead>
        <tbody>
          {% for register in registers %}
          <tr  class="tableRow border_bottom" data-child-value="{{loop.index}}" data-child-description="{{register.details|safe}}">
            <td class="details-control"></td>
            <td><span class="registerName">{{register.name}}</span></td>
            <td><span class="desline"><i class="shortdes">{{register.description|safe}}</i>&nbsp;&nbsp;&nbsp;<i class="details-expand shortdes" >More..</i>&nbsp;&nbsp;&nbsp;</span></td>
            <td>{{register.address}}</td>
            <td>{{register.type}}</td>
            <td>{{register.readwrite}}</td>
            <td>{{register.tags |safe}}</td>
            <td>{{register.devices}}</td>
            <td>{% for name in register.list_of_names %}{{name.name}} {% endfor %}</td>
            <td>{% for address in register.list_of_names %}{{address.address}} {% endfor %}</td>
          </tr>
          <div id="{{loop.index}}"> </div>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
    <script src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.18/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('select').selectpicker();
        $('#content-hide').hide();
        var table = $('#modbus').DataTable({
          "dom": '<f><t><pil>',
          "dom": '<"toolbar">frtip',
          fnInitComplete: function(){
            $('div.toolbar').html('<select id="devices-select" class="selectpicker"><option value="">All Devices</option><option value="DIGIT">DIGIT</option><option value="T7">T7</option><option value="T4">T4</option></select>');
          },
          "columnDefs": [{
              "targets": [7],
              "visible": false
            },
            {
              "targets": [0],
              "bSortable": false
            },
            {
              "targets": [8],
              "visible": false
            },
            {
              "targets": [9],
              "visible": false
            },
            {
              "targets": [5],
              "bSortable": false
            },
            {
              "targets": [4],
              "bSortable": false
            },
            {
              "targets": [6],
              "bSortable": false
            }
          ]
        });

        // Add event listener for opening and closing details
        $('#modbus').on('click', 'td.details-control', function () {
          var tr = $(this).closest('tr');
          var row = table.row(tr);
          detailsExpand(row, tr)
        });
        $('#modbus').on('click', 'i.details-expand', function () {
          var tr = $(this).closest('tr');
          var row = table.row(tr);
          detailsExpand(row, tr)
        });

        $("#devices-select").change(function () {
          table.columns(7).search($("#devices-select option:selected").val()).draw();
        });
        $("#Access").change(function () {
          table.columns(5).search($("#Access option:selected").val()).draw();
        });
        $("#Type").change(function () {
          table.columns(4).search($("#Type option:selected").val()).draw();
        });
        $("#Tags").change(function () {
          var value = $('#Tags').val()
          if (value != null) {
            value = value.join(' ');
          } else {
            value = "";
          }
          table.columns(6).search(value).draw();
        });
      });

      function detailsExpand(row, tr) {
        if (row.child.isShown()) {
          // This row is already open - close it
          row.child.hide();
          tr.removeClass('shown');
          tr.find('.shortdes').show();
        } else {
          // Open this row
          tr.find('.shortdes').hide();
          row.child(tr.data('child-description')).show();
          row.child().addClass('expand-details')
          tr.addClass('shown');
        }
      }

      function showHidden(id) {
        $('#' + id).css('display', 'inline');
        $('#' + id + '1').css('display', 'inline');
        document.getElementById("show" + id).style.display = "none";
        document.getElementById("show1" + id).style.display = "none";
      }
    </script>
  </body>
</html>
